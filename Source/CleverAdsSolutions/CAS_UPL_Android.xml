<?xml version="1.0" encoding="utf-8"?>
<root xmlns:android="http://schemas.android.com/apk/res/android">
	<init>
		<log text="Clever Ads Solutions (CAS) Initialization"/>

		<setStringFromProperty result="CASAppID" ini="Engine" section="/Script/CleverAdsSolutions.CASSettings" property="AndroidCASAppID"/>
		<setStringFromProperty result="AdmobAppID" ini="Engine" section="/Script/CleverAdsSolutions.CASSettings" property="AndroidAdmobAppID"/>
		<setBoolFromProperty result="TestMode" ini="Engine" section="/Script/CleverAdsSolutions.CASSettings" property="TestAds" default="true"/>
		<setBoolFromProperty result="DebugMode" ini="Engine" section="/Script/CleverAdsSolutions.CASSettings" property="DebugMode" default="true"/>

		<setStringFromProperty result="ConfigFile" ini="Engine" section="/Script/CleverAdsSolutions.CASSettings" property="AndroidSettingsFile" default=""/>
		<setStringFromProperty result="ConfigFileID" ini="Engine" section="/Script/CleverAdsSolutions.CASSettings" property="AndroidSettingsFileID" default=""/>

		<!-- Network flags from configs -->
		<setBoolFromProperty result="EnableAppLovin" ini="Engine" section="/Script/CleverAdsSolutions.CASSettings" property="EnableAppLovinAndroid" default="false"/>
		<setBoolFromProperty result="EnableFacebook" ini="Engine" section="/Script/CleverAdsSolutions.CASSettings" property="EnableFacebookAndroid" default="false"/>
		<setBoolFromProperty result="EnableIronsource" ini="Engine" section="/Script/CleverAdsSolutions.CASSettings" property="EnableIronsourceAndroid" default="false"/>
		<setBoolFromProperty result="EnableGoogleAdMob" ini="Engine" section="/Script/CleverAdsSolutions.CASSettings" property="EnableGoogleAdMobAndroid" default="false"/>
		<setBoolFromProperty result="EnableAdColony" ini="Engine" section="/Script/CleverAdsSolutions.CASSettings" property="EnableAdColonyAndroid" default="false"/>
		<setBoolFromProperty result="EnableMintegral" ini="Engine" section="/Script/CleverAdsSolutions.CASSettings" property="EnableMintegralAndroid" default="false"/>
		<setBoolFromProperty result="EnableMyTarget" ini="Engine" section="/Script/CleverAdsSolutions.CASSettings" property="EnableMyTargetAndroid" default="false"/>
		<setBoolFromProperty result="EnableInMobi" ini="Engine" section="/Script/CleverAdsSolutions.CASSettings" property="EnableInMobiAndroid" default="false"/>
		<setBoolFromProperty result="EnablePangle" ini="Engine" section="/Script/CleverAdsSolutions.CASSettings" property="EnablePangleAndroid" default="false"/>
		<setBoolFromProperty result="EnableTapjoy" ini="Engine" section="/Script/CleverAdsSolutions.CASSettings" property="EnableTapjoyAndroid" default="false"/>
		<setBoolFromProperty result="EnableUnityAds" ini="Engine" section="/Script/CleverAdsSolutions.CASSettings" property="EnableUnityAdsAndroid" default="false"/>
		<setBoolFromProperty result="EnableVungle" ini="Engine" section="/Script/CleverAdsSolutions.CASSettings" property="EnableVungleAndroid" default="false"/>
		<setBoolFromProperty result="EnableYandex" ini="Engine" section="/Script/CleverAdsSolutions.CASSettings" property="EnableYandexAndroid" default="false"/>
	</init>

	<androidManifestUpdates>
		
		<!-- CAS App ID -->
		<setElement result="CASKeyElem" value="meta-data" />
		<addAttribute tag="$CASKeyElem" name="android:name" value="cas.sdk.appid" />
		<addAttribute tag="$CASKeyElem" name="android:value" value="$S(CASAppID)" />
		<addElement tag="application" name="CASKeyElem" />
		
		<!-- Test ads mode -->
		<if condition="TestMode">
			<true>
				<addElements tag="application">
					<meta-data android:name="cas.sdk.testmode" android:value="true"/>
				</addElements>
			</true>
		</if>

		<!-- Debug mode -->
		<if condition="DebugMode">
			<true>
				<addElements tag="application">
					<meta-data android:name="cas.sdk.debugmode" android:value="true"/>
				</addElements>
			</true>
		</if>

		<!-- AdMob App ID -->
		<if condition="EnableGoogleAdMob">
			<true>
				<setElement result="AdmobKeyElem" value="meta-data" />
				<addAttribute tag="$AdmobKeyElem" name="android:name" value="com.google.android.gms.ads.APPLICATION_ID" />
				<addAttribute tag="$AdmobKeyElem" name="android:value" value="$S(AdmobAppID)" />
				<addElement tag="application" name="AdmobKeyElem" />
			</true>
		</if>
		
	</androidManifestUpdates>
	
	<buildGradleAdditions>
		<insert>
			android {
				compileOptions {
					sourceCompatibility 1.8
					targetCompatibility 1.8
				}
			}
			
			repositories {
				google()
				mavenCentral()
			}

			dependencies {
				implementation 'com.cleveradssolutions:cas-sdk:2.9.9'

				implementation 'com.google.android.material:material:1.0.0'
				implementation "androidx.constraintlayout:constraintlayout:1.1.3"
			}
		</insert>
		
		<!-- Networks integration -->
		
		<!-- AppLovin -->
		<if condition="EnableAppLovin"><true><insert>
			dependencies { implementation 'com.cleveradssolutions:applovin:11.6.1.0' }
		</insert></true></if>

		<!-- Facebook -->
		<if condition="EnableFacebook"><true><insert>
			dependencies { implementation 'com.cleveradssolutions:facebook:6.12.0.1' }
		</insert></true></if>

		<!-- Ironsource -->
		<if condition="EnableIronsource"><true><insert>
			dependencies { implementation 'com.cleveradssolutions:ironsource:7.2.6.0' }
			repositories { maven { url = "https://android-sdk.is.com/" } }
		</insert></true></if>

		<!-- Google AdMob -->
		<if condition="EnableGoogleAdMob"><true><insert>
			dependencies { implementation 'com.cleveradssolutions:google:21.4.0.1' }
		</insert></true></if>

		<!-- Ad Colony -->
		<if condition="EnableAdColony"><true><insert>
			dependencies { implementation 'com.cleveradssolutions:adcolony:4.8.0.6' }
		</insert></true></if>
		
		<!-- Mintegral -->
		<if condition="EnableMintegral"><true><insert>
			dependencies { implementation 'com.cleveradssolutions:mintegral:16.3.51.0' }
			repositories { maven { url = "https://dl-maven-android.mintegral.com/repository/mbridge_android_sdk_oversea" } }
		</insert></true></if>
		
		<!-- My Target -->
		<if condition="EnableMyTarget"><true><insert>
			dependencies { implementation 'com.cleveradssolutions:mytarget:5.16.3.0' }
		</insert></true></if>

		<!-- InMobi -->
		<if condition="EnableInMobi"><true><insert>
			dependencies { implementation 'com.cleveradssolutions:inmobi:10.1.2.0' }
		</insert></true></if>
		
		<!-- Pangle -->
		<if condition="EnablePangle"><true><insert>
			dependencies { implementation 'com.cleveradssolutions:pangle:4.9.0.7' }
			repositories { maven { url = "https://artifact.bytedance.com/repository/pangle" } }
		</insert></true></if>

		<!-- Tapjoy -->
		<if condition="EnableTapjoy"><true><insert>
			dependencies { implementation 'com.cleveradssolutions:tapjoy:12.11.1.0' }
			repositories { maven { url = "https://sdk.tapjoy.com/" } }
		</insert></true></if>

		<!-- Unity Ads -->
		<if condition="EnableUnityAds"><true><insert>
			dependencies { implementation 'com.cleveradssolutions:unity:4.5.0.1' }
		</insert></true></if>

		<!-- Vungle -->
		<if condition="EnableVungle"><true><insert>
			dependencies { implementation 'com.cleveradssolutions:vungle:6.12.0.6' }
		</insert></true></if>
		
		<!-- Yandex -->
		<if condition="EnableYandex"><true><insert>
			dependencies { implementation 'com.cleveradssolutions:yandex:20.5.0.0' }
		</insert></true></if>
	</buildGradleAdditions>

	<prebuildCopies>
		<!-- Copy custom java interfaces to call from JNI -->
		<copyDir src="$S(PluginDir)/External/Android/" dst="$S(BuildDir)/src"/>

		<!-- Copy CAS settings fie -->
		<copyFile src="$S(PluginDir)/../../../../$S(ConfigFile)" dst="$S(BuildDir)/res/raw/cas_settings$S(ConfigFileID).json" force="false"/>
	</prebuildCopies>

	<proguardAdditions>
		<insert>
			-dontwarn com.unreal.cas.**
			-keep class com.unreal.cas.** { *; }
		</insert>
	</proguardAdditions>

	<gameActivityImportAdditions>
		<insert>
			<![CDATA[
				import com.unreal.cas.CASUnrealManager;
			]]>
		</insert>
	</gameActivityImportAdditions>

	<gameActivityOnCreateAdditions>
		<insert>
			<![CDATA[
				CASUnrealManager.InitActivity(this);
			]]>
		</insert>
	</gameActivityOnCreateAdditions>

</root>
