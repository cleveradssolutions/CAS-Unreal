<?xml version="1.0" encoding="utf-8"?>
<root>
	<init>
		<log text="Clever Ads Solutions (CAS) Initialization"/>

		<!-- Copy CAS settings file -->
		<setStringFromProperty result="ConfigFile" ini="Engine" section="/Script/CleverAdsSolutions.CASSettings" property="IOSSettingsFile" default=""/>
		<setStringFromProperty result="ConfigFileID" ini="Engine" section="/Script/CleverAdsSolutions.CASSettings" property="IOSSettingsFileID" default=""/>
		<copyFile src="$S(PluginDir)/../../../../$S(ConfigFile)" dst="$S(BuildDir)/cas_settings$S(ConfigFileID).json" force="false"/>
		
		<!-- Copy CAS framework -->
		<copyDir src="$S(EngineDir)/Intermediate/UnzippedFrameworks/CleverAdsSolutions/CleverAdsSolutions.embeddedframework/CleverAdsSolutions.framework" dst="$S(BuildDir)/Frameworks/CleverAdsSolutions.framework" />

		<!-- AdMob App ID -->
		<setStringFromProperty result="AdmobAppID" ini="Engine" section="/Script/CleverAdsSolutions.CASSettings" property="IOSAdmobAppID"/>
		<setBoolFromProperty result="EnableGoogleAdMob" ini="Engine" section="/Script/CleverAdsSolutions.CASSettings" property="EnableGoogleAdMobIOS" default="false"/>
	</init>

	<iosPListUpdates>
		<loopElements tag="$">
			<setStringFromTag result="CurrentTag" tag="$"/>
			<setBoolIsEqual   result="isRootDictionary" arg1="$S(CurrentTag)" arg2="dict"/>
			<!-- Process root dict only -->
			<if condition="isRootDictionary">
				<true>
					<!-- AdMob App ID -->
					<if condition="EnableGoogleAdMob">
						<true>
							<setElement result="AdMobSdkKeyElem" value="key" text="GADApplicationIdentifier"/>
							<addElement tag="$" name="AdMobSdkKeyElem"/>
							<setElement result="AdMobSdkValueElem" value="string" text="$S(AdmobAppID)"/>
							<addElement tag="$" name="AdMobSdkValueElem"/>
						</true>
					</if>
				</true>
			</if>
		</loopElements>
	</iosPListUpdates>
</root>
